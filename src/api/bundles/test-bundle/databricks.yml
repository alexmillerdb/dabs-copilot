bundle:
  name: test-bundle

variables:
  catalog:
    description: Unity Catalog name
    default: main
  environment:
    description: Target environment
    default: dev
  compute_profile:
    description: Cluster size profile
    default: small

targets:
  dev:
    default: true
    workspace:
      host: https://dbc-dp-1444828305810485.cloud.databricks.com
      root_path: /Workspace/Users/${workspace.current_user.userName}/bundles/test-bundle-dev
    run_as:
      user_name: ${workspace.current_user.userName}
    variables:
      environment: dev
      catalog: dev_catalog

resources:
  jobs:
    test_job:
      name: ${var.environment}_test_job
      job_clusters:
        - job_cluster_key: main_compute
          new_cluster:
            spark_version: "14.3.x-scala2.12"
            node_type_id: "i3.xlarge"
            num_workers: 1
            cluster_source: JOB
      tasks:
        - task_key: hello_world
          job_cluster_key: main_compute
          python_wheel_task:
            package_name: my_test_package
            entry_point: hello_world
          libraries:
            - pypi:
                package: requests
        - task_key: simple_spark
          job_cluster_key: main_compute
          spark_python_task:
            python_file: /Workspace/Users/${workspace.current_user.userName}/test_spark.py
          depends_on:
            - task_key: hello_world
      schedule:
        quartz_cron_expression: "0 0 9 * * ?"
        timezone_id: "America/Los_Angeles"
        pause_status: PAUSED
      email_notifications:
        on_start: []
        on_success: []
        on_failure: []
      timeout_seconds: 3600
      max_concurrent_runs: 1

  clusters:
    shared_cluster:
      cluster_name: ${var.environment}_shared_cluster
      spark_version: "14.3.x-scala2.12"
      node_type_id: "i3.xlarge"
      num_workers: 2
      autoscale:
        min_workers: 1
        max_workers: 4
      spark_conf:
        "spark.databricks.cluster.profile": "singleNode"
        "spark.master": "local[*]"
      custom_tags:
        environment: ${var.environment}
        project: test-bundle